---
layout: post
title:  "后台服务器搭建基础流程"
date:   2017-02-19 21:06:00
categories: Others  
tags: [整理]
---

时隔一段时间，又要接触后台服务器的开发了。在这里记录一下从零开始的一些工作流程，以供参考。

目录：
1. 开发服务器搭建
2. Git服务器搭建及项目导入
3. Laravel服务器搭建

## 开发服务器搭建

####1. 获取服务器相关账号、密码

####2. 添加工作账户
远程连接服务器，执行以下命令：
adduser [username]
比如：adduser chenkai
添加用户到sudoer列表中：sudo vim /etc/sudoer
在最后添加一行：
[username] ALL=(ALL:ALL) ALL
chenkai ALL=(ALL:ALL) ALL

####3. 配置本机快捷连接
- 配置alias
vim ~/.zshrc，添加以下内容：
alias ssh[company]-dev="ssh [username]@[ip]"
比如：alias sshmojie-dev="ssh chenkai@118.89.219.35"
- 配置ssh公钥免密码登录
把个人pc的ssh公钥添加到服务器上
scp -p ~/.ssh/id_rsa.pub [username]@<remote_ip>:/home/[username]/.ssh/authorized_keys
scp -p ~/.ssh/id_rsa.pub chenkai@<remote_ip>:/home/chenkai/.ssh/authorized_keys

注意：
.ssh目录的权限必须是700 
.ssh/authorized_keys文件权限必须是600

这样就能够通过命令直接登录上服务器了：ssh[companve]-dev

## 配置Git服务器
配置Git服务器主要分为以下几步：
- 安装git并创建git用户
- 创建当前项目的git仓库
- 在服务器上创建项目的目录
- 在本地尝试完成git项目的导入

首先创建git用户：
adduser git
参考【配置ssh公钥免密码登录】模块，在git账户的.ssh目录下放置本地机器的公钥，实现免密码登录。
在git的home目录下创建一个目录，专门用来放置Git项目的仓库：
mkdir /home/git/Repository

设GIT_REPO目录为/home/git/Repository，在当前目录下创建项目的git仓库[project].git
sudo mkdir [project].git
sudo mkdir mojie-laravel.git

赋予文件夹归属权限：
sudo chown git:git [project].git
赋予文件夹操作权限：
sudo chmod -R 777 [project].git

进入文件夹内，输入命令：git --bare init
这样git仓库就创建完成了。接下来第三步，创建服务器上的代码目录。
laravel new [project]
假设在/home/[username]下放置项目代码，可参考Laravel项目相关操作。理论上服务器上不需要再进行其它修改。
假设已经完成，生成项目文件夹[project]，完成后，进入目录/home/[username]/[project]
为当前目录设置远程仓库
git init
git remote add origin git@localhost:/home/git/Repository/mojie_laravel.git

看一下.gitignore，确保/vendor等文件夹不会被添加到git仓库中
git add .
git commit -m "initial commit"
git push --set-upstream origin master
git push
这样就提交到远程仓库中了。

第四步，回到本地macbook pro，进入工作目录[work_dir]，比如/home/chenkai/Lionel/Work/Mojie/code/
git clone git@118.89.219.35:/home/git/Repository/mojie_laravel.git
就把相关代码拉取下来了。

## Laravel服务器搭建

以Laravel 5.4为例。
首先安装laravel，参考

凭空的情况，是需要执行命令创建项目：
laravel new [project]
比如laravel new mojie_laravel
（如果在本地）进入项目文件夹内
composer install
mv .env.example .env
php artisan key:generate
这时候设置好nginx的路径，具体可以参考：
http://blog.csdn.net/qq_28666081/article/details/52728701
这时候，浏览器打开，应该能显示laravel的welcome画面了。

如果要使用post方法，需要去除verifyCsrfToken
在/app/Http/Middleware/VerifyCsrfToken.php文件中，将protected $except = []加一项'*'

关于Laravel+Nginx配置，还有一点比较坑的是，storage目录要777权限，否则一直莫名奇妙的500



